<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MagicSea</title>
  <meta name="description" content="MagicSea æ‘„å½±ä½œå“é›†">
  
  <!-- å‹ç¼©ç‰ˆæœ¬çš„CSSï¼Œå‡å°‘åŠ è½½æ—¶é—´ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #faf9f7; /* ç±³ç™½è‰²èƒŒæ™¯ */
      color: #2d3748;
    }
    
    .modern-font {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      font-weight: 600;
      letter-spacing: -0.02em;
    }
    
    .title-font {
      font-family: 'Playfair Display', serif;
      font-weight: 400;
      letter-spacing: 0.02em;
    }
    
    .photo-item {
      transition: transform 0.3s ease;
      break-inside: avoid;
    }
    
    .photo-item:hover {
      transform: scale(1.02);
    }
    
    .photo-item img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* ç€‘å¸ƒæµå¸ƒå±€ - ç¼©å°é—´è· */
    .masonry {
      column-count: 2;
      column-gap: 1rem;
    }
    
    @media (min-width: 768px) {
      .masonry {
        column-count: 3;
        column-gap: 1rem;
      }
    }
    
    @media (min-width: 1024px) {
      .masonry {
        column-count: 4;
        column-gap: 1rem;
      }
    }
    
    /* å·¦ä¾§è¾¹æ  */
    .sidebar {
      width: 280px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      background-color: #f7f6f4;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 3rem 2rem;
      z-index: 10;
    }
    
    /* ä¸»å†…å®¹åŒºåŸŸ */
    .main-content {
      margin-left: 280px;
      min-height: 100vh;
      padding: 2rem;
    }
    
    /* å“åº”å¼ï¼šç§»åŠ¨è®¾å¤‡éšè—ä¾§è¾¹æ ï¼Œæ”¹ä¸ºé¡¶éƒ¨ */
    @media (max-width: 768px) {
      .sidebar {
        position: relative;
        width: 100%;
        height: auto;
        padding: 2rem 1rem;
      }
      
      .main-content {
        margin-left: 0;
        padding: 1rem;
      }
      
      .masonry {
        column-count: 2;
        column-gap: 0.5rem;
      }
    }
    
    /* ç®€å•çš„loadingæ•ˆæœ */
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.8s ease-in forwards;
    }
    
    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* ç¯ç®±æ ·å¼ */
    .lightbox-content {
      width: 90vw;
      height: 80vh;
      display: flex;
      flex-direction: row;
      align-items: stretch;
      justify-content: center;
      position: relative;
      gap: 0.5rem;
    }
    
    .lightbox-image-container {
      flex: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 0;
    }

    .lightbox-image {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }
    
    .lightbox-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: flex-end;
      text-align: right;
      padding: 3rem 1rem 2rem 3rem;
      min-width: 280px;
      max-width: 420px;
    }

    .lightbox-info h2 {
      line-height: 1.4;
      margin-bottom: 0.5rem;
      font-weight: 300;
      letter-spacing: 0.02em;
      word-spacing: 0.1em;
    }

    .lightbox-info p {
      line-height: 1.6;
      letter-spacing: 0.15em;
      opacity: 0.8;
    }

    .lightbox-description {
      color: #6b7280;
      font-style: italic;
      line-height: 1.7;
      margin-top: 1.5rem;
      font-size: 0.9rem;
      max-width: 300px;
      font-weight: 300;
      letter-spacing: 0.01em;
      opacity: 0.9;
      text-align: right;
    }
    
    .lightbox-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #6b7280;
      transition: all 0.2s;
      z-index: 10;
      padding: 0.5rem;
      border-radius: 50%;
      backdrop-filter: blur(2px);
    }
    
    .lightbox-close:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #374151;
      transform: scale(1.1);
    }
    
    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #6b7280;
      transition: all 0.2s;
    }
    
    .lightbox-nav:hover {
      color: #374151;
    }

    /* æ¡Œé¢ç«¯å¯¼èˆªæŒ‰é’®çš„ç‰¹æ®Šæ ·å¼ */
    .lightbox-prev .lightbox-arrow,
    .lightbox-next .lightbox-arrow {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      padding: 0.5rem;
      backdrop-filter: blur(2px);
      transition: all 0.2s;
    }

    .lightbox-prev:hover .lightbox-arrow,
    .lightbox-next:hover .lightbox-arrow {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.2);
    }
    
    .lightbox-prev {
      left: 0;
      width: 50%;
      height: 100%;
      top: 0;
      transform: none;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding-left: 3rem;
      background: transparent;
      border-radius: 0;
      backdrop-filter: none;
    }
    
    .lightbox-next {
      right: 0;
      width: 50%;
      height: 100%;
      top: 0;
      transform: none;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 3rem;
      background: transparent;
      border-radius: 0;
      backdrop-filter: none;
    }
    
    @media (max-width: 768px) {
      .lightbox-content {
        width: 95vw;
        height: 90vh;
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .lightbox-info {
        flex: none;
        min-width: auto;
        max-width: none;
        padding: 0.5rem 1rem;
        order: 2;
        justify-content: flex-start;
        text-align: center;
      }

      .lightbox-info h2 {
        font-size: 1rem;
        margin-bottom: 0.25rem;
        font-weight: 400;
      }

      .lightbox-info p {
        font-size: 0.75rem;
        margin-bottom: 0.5rem;
        opacity: 0.7;
      }

      .lightbox-description {
        font-size: 0.75rem;
        margin-top: 0.5rem;
        max-width: none;
        text-align: center;
        line-height: 1.4;
      }

      .lightbox-image-container {
        flex: 1;
        order: 1;
        padding: 0 1rem;
      }
      
      .lightbox-close {
        top: 1rem;
        right: 1rem;
        font-size: 1.25rem;
        padding: 0.4rem;
      }
      
      .lightbox-prev {
        left: 1rem;
        top: 45%;
        font-size: 1.25rem;
        width: auto;
        height: auto;
        transform: translateY(-50%);
        padding: 0;
        justify-content: center;
        background: transparent;
        border-radius: 0;
        backdrop-filter: none;
      }
      
      .lightbox-next {
        right: 1rem;
        top: 45%;
        font-size: 1.25rem;
        width: auto;
        height: auto;
        transform: translateY(-50%);
        padding: 0;
        justify-content: center;
        background: transparent;
        border-radius: 0;
        backdrop-filter: none;
      }

      .lightbox-prev .lightbox-arrow,
      .lightbox-next .lightbox-arrow {
        padding: 0.4rem;
      }
    }

    /* æ‹–æ‹½ä¸Šä¼ æ ·å¼ */
    .drag-over {
      border-color: #4f46e5 !important;
      background-color: #f3f4f6;
    }

    .upload-area {
      transition: all 0.3s ease;
    }

    /* ç¯ç®±åŠ¨ç”» */
    #gallery {
      transition: all 0.3s ease;
    }

    #gallery.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #gallery:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }

    .lightbox-content {
      transition: transform 0.3s ease;
    }

    #gallery.hidden .lightbox-content {
      transform: scale(0.9);
    }

    #gallery:not(.hidden) .lightbox-content {
      transform: scale(1);
    }
  </style>
</head>

<body class="min-h-screen" style="background-color: #faf9f7;">
  <!-- å·¦ä¾§è¾¹æ  -->
  <aside class="sidebar">
    <div>
      <h1 class="text-xl md:text-2xl text-gray-800 title-font">
        MagicSea
      </h1>
      <p class="text-sm text-gray-600 mt-4 leading-relaxed">
        Photography Collection
      </p>
    </div>
    
    <div>
      <div class="space-y-2">
        <!-- å¯¼å…¥ç…§ç‰‡æ•°æ®æŒ‰é’® -->
        <button onclick="showImportDialog()" 
                class="text-xs text-blue-600 hover:text-blue-800 transition-colors block">
          ğŸ“¥ å¯¼å…¥ç…§ç‰‡æ•°æ®
        </button>
        
        <p class="text-xs font-thin text-gray-600 title-font">
          <a href="https://0xlau.com" target="_blank" class="hover:text-gray-800 transition-colors">
            0xlau.com
          </a>
        </p>
      </div>
    </div>
  </aside>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <main class="main-content">
    <div class="masonry">
      <!-- ç…§ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
    </div>
  </main>

  <!-- ç¯ç®± -->
  <div id="gallery" class="fixed inset-0 z-50 hidden" style="background-color: rgba(250, 249, 247, 0.95); backdrop-filter: blur(8px);">
    <div class="w-full h-full flex items-center justify-center p-8 relative">
      <!-- å…³é—­æŒ‰é’® -->
      <button class="lightbox-close" onclick="closeGallery()">Ã—</button>
      
      <!-- å·¦ç®­å¤´ -->
      <button class="lightbox-nav lightbox-prev" onclick="previousImage()">
        <span class="lightbox-arrow">â€¹</span>
      </button>
      
      <!-- å³ç®­å¤´ -->
      <button class="lightbox-nav lightbox-next" onclick="nextImage()">
        <span class="lightbox-arrow">â€º</span>
      </button>
      
      <!-- ç…§ç‰‡å±•ç¤ºåŒº -->
      <div class="lightbox-content">
        <!-- å·¦ä¾§æ–‡å­—ä¿¡æ¯ -->
        <div class="lightbox-info">
          <div>
            <h2 id="gallery-title" class="text-lg font-light text-gray-900 mb-2 title-font tracking-wide">Photography Collection</h2>
            <p id="gallery-location" class="text-xs text-gray-500 mb-4 font-light tracking-wider uppercase">Location, Country</p>
          </div>
        </div>
        
        <!-- å³ä¾§å›¾ç‰‡ -->
        <div class="lightbox-image-container">
          <img id="gallery-img" src="" alt="" class="lightbox-image">
        </div>
      </div>
    </div>
  </div>

  <!-- å¯¼å…¥æ•°æ®å¯¹è¯æ¡† -->
  <div id="importDialog" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <div class="text-center mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-2">å¯¼å…¥ç…§ç‰‡æ•°æ®</h3>
        <p class="text-sm text-gray-600">ä»æœ¬åœ°ç®¡ç†åå°å¯¼å‡ºçš„JSONæ–‡ä»¶å¯¼å…¥æ‚¨çš„ç…§ç‰‡</p>
      </div>
      
      <div class="space-y-4">
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
          <input type="file" id="importFileInput" accept=".json" class="hidden">
          <button onclick="document.getElementById('importFileInput').click()" 
                  class="text-blue-600 hover:text-blue-800">
            ğŸ“ é€‰æ‹©JSONæ–‡ä»¶
          </button>
          <p class="text-xs text-gray-500 mt-2">é€‰æ‹©ä»ç®¡ç†åå°å¯¼å‡ºçš„å¤‡ä»½æ–‡ä»¶</p>
        </div>
        
        <div class="text-xs text-gray-500 bg-gray-50 p-3 rounded">
          <p class="font-medium mb-1">ğŸ’¡ å¦‚ä½•è·å–ç…§ç‰‡æ•°æ®ï¼š</p>
          <p>1. è®¿é—®æœ¬åœ°ç®¡ç†åå° (localhost:8000/admin.html)</p>
          <p>2. ç‚¹å‡»"å¯¼å‡ºç…§ç‰‡"æŒ‰é’®</p>
          <p>3. ä¸‹è½½JSONæ–‡ä»¶ååœ¨æ­¤å¤„å¯¼å…¥</p>
        </div>
      </div>
      
      <div class="flex justify-end space-x-3 mt-6">
        <button onclick="closeImportDialog()" 
                class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
          å–æ¶ˆ
        </button>
      </div>
    </div>
  </div>

  <script>
    // é»˜è®¤ç¤ºä¾‹ç…§ç‰‡æ•°æ® (å¯ä»¥é¢„è®¾ä¸€äº›ç¤ºä¾‹ç…§ç‰‡)
    const defaultPhotos = [
      {
        src: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        alt: "å±±å³°æ—¥å‡º",
        location: "Alps, Switzerland",
        description: "é˜¿å°”å‘æ–¯å±±è„‰çš„æ—¥å‡ºæ—¶åˆ†ï¼Œé‡‘è‰²çš„é˜³å…‰æ´’åœ¨é›ªå±±ä¹‹ä¸Šã€‚",
        isUserPhoto: false
      },
      {
        src: "https://images.unsplash.com/photo-1439066615861-d1af74d74000?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        alt: "æ¹–æ³Šå€’å½±",
        location: "Banff, Canada",
        description: "æ¸…æ™¨çš„æ¹–æ³Šå¦‚é•œé¢èˆ¬å¹³é™ï¼Œå®Œç¾å€’æ˜ ç€å‘¨å›´çš„å±±å³¦ã€‚",
        isUserPhoto: false
      },
      {
        src: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        alt: "æ£®æ—å°å¾„",
        location: "Oregon, USA",
        description: "é˜³å…‰é€è¿‡èŒ‚å¯†çš„æ£®æ—ï¼Œåœ¨å°å¾„ä¸Šæ´’ä¸‹æ–‘é©³çš„å…‰å½±ã€‚",
        isUserPhoto: false
      }
    ];

    // ç…§ç‰‡æ•°æ®ç®¡ç†
    let photos = [];
    let currentImageIndex = 0;

    // åˆå§‹åŒ–ç…§ç‰‡æ•°æ®
    function initPhotos() {
      const savedPhotos = localStorage.getItem('userPhotos');
      const userPhotos = savedPhotos ? JSON.parse(savedPhotos) : [];
      // ä¼˜å…ˆæ˜¾ç¤ºç”¨æˆ·ç…§ç‰‡ï¼Œå¦‚æœæ²¡æœ‰ç”¨æˆ·ç…§ç‰‡åˆ™æ˜¾ç¤ºç¤ºä¾‹ç…§ç‰‡
      photos = userPhotos.length > 0 ? [...userPhotos] : [...defaultPhotos];
      renderPhotos();
    }

    // ç¯ç®±åŠŸèƒ½
    function openGallery(index) {
      currentImageIndex = index;
      showImage(index);
      const gallery = document.getElementById('gallery');
      gallery.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // è§¦å‘é‡æ’ä»¥ç¡®ä¿åŠ¨ç”»æ•ˆæœ
      gallery.offsetHeight;
    }

    function showImage(index) {
      const photo = photos[index];
      const img = document.getElementById('gallery-img');
      const title = document.getElementById('gallery-title');
      const locationEl = document.getElementById('gallery-location');
      
      img.src = photo.src;
      title.textContent = photo.alt;
      
      // å¦‚æœæœ‰æè¿°ä¿¡æ¯ï¼Œæ˜¾ç¤ºåœ¨ä½ç½®ä¸‹æ–¹
      if (photo.description && photo.description.trim()) {
        locationEl.innerHTML = `${photo.location}<div class="lightbox-description">${photo.description}</div>`;
      } else {
        locationEl.textContent = photo.location;
      }
    }

    function closeGallery() {
      const gallery = document.getElementById('gallery');
      gallery.classList.add('hidden');
      
      // å»¶è¿Ÿæ¢å¤æ»šåŠ¨ï¼Œç­‰å¾…åŠ¨ç”»å®Œæˆ
      setTimeout(() => {
        document.body.style.overflow = '';
      }, 300);
    }

    function nextImage() {
      currentImageIndex = (currentImageIndex + 1) % photos.length;
      showImage(currentImageIndex);
    }

    function previousImage() {
      currentImageIndex = (currentImageIndex - 1 + photos.length) % photos.length;
      showImage(currentImageIndex);
    }

    // é”®ç›˜äº‹ä»¶
    document.addEventListener('keydown', function(e) {
      if (document.getElementById('gallery').classList.contains('hidden')) return;
      
      switch(e.key) {
        case 'Escape':
          closeGallery();
          break;
        case 'ArrowLeft':
          previousImage();
          break;
        case 'ArrowRight':
          nextImage();
          break;
      }
    });

    // ç§»åŠ¨ç«¯æ»‘åŠ¨æ‰‹åŠ¿æ”¯æŒ
    let touchStartX = 0;
    let touchEndX = 0;
    
    function handleGesture() {
      if (touchEndX < touchStartX - 50) {
        // å‘å·¦æ»‘åŠ¨ï¼Œæ˜¾ç¤ºä¸‹ä¸€å¼ 
        nextImage();
      }
      if (touchEndX > touchStartX + 50) {
        // å‘å³æ»‘åŠ¨ï¼Œæ˜¾ç¤ºä¸Šä¸€å¼ 
        previousImage();
      }
    }
    
    document.getElementById('gallery').addEventListener('touchstart', function(e) {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    document.getElementById('gallery').addEventListener('touchend', function(e) {
      touchEndX = e.changedTouches[0].screenX;
      handleGesture();
    });

    // ç‚¹å‡»èƒŒæ™¯å…³é—­ç”»å»Š
    document.getElementById('gallery').addEventListener('click', function(e) {
      if (e.target === this) {
        closeGallery();
      }
    });

    // æ€§èƒ½ä¼˜åŒ–ï¼šå›¾ç‰‡æ‡’åŠ è½½
    const images = document.querySelectorAll('img');
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.style.opacity = '1';
          imageObserver.unobserve(img);
        }
      });
    });

    images.forEach(img => {
      img.style.opacity = '0';
      img.addEventListener('load', () => {
        img.style.transition = 'opacity 0.5s';
        img.style.opacity = '1';
      });
      imageObserver.observe(img);
    });

    // ä¸Šä¼ æ¨¡æ€æ¡†æ§åˆ¶
    function openUploadModal() {
      const modal = document.getElementById('uploadModal');
      if (modal) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    }

    // æ¸…ç†å­˜å‚¨åŠŸèƒ½
    function clearStorage() {
      if (confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ç”¨æˆ·ç…§ç‰‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
        localStorage.removeItem('userPhotos');
        // é‡æ–°åˆå§‹åŒ–ï¼Œåªæ˜¾ç¤ºé»˜è®¤ç…§ç‰‡
        photos = [...defaultPhotos];
        renderPhotos();
        showMessage('å­˜å‚¨å·²æ¸…ç†', 'info');
      }
    }

    // è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
    function getStorageInfo() {
      try {
        const used = JSON.stringify(localStorage).length;
        const quota = 5 * 1024 * 1024; // å‡è®¾5MBé™åˆ¶
        return {
          used: used,
          quota: quota,
          percentage: Math.round((used / quota) * 100)
        };
      } catch (e) {
        return { used: 0, quota: 0, percentage: 0 };
      }
    }

    // å¯¼å…¥å¯¹è¯æ¡†åŠŸèƒ½
    function showImportDialog() {
      document.getElementById('importDialog').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeImportDialog() {
      document.getElementById('importDialog').classList.add('hidden');
      document.body.style.overflow = '';
    }

    // å¤„ç†æ–‡ä»¶å¯¼å…¥
    function handleImportFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedPhotos = JSON.parse(e.target.result);
          if (!Array.isArray(importedPhotos)) {
            throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
          }
          
          // éªŒè¯æ•°æ®æ ¼å¼
          const validPhotos = importedPhotos.filter(photo => 
            photo.src && photo.alt && photo.location && photo.isUserPhoto
          );
          
          if (validPhotos.length === 0) {
            alert('æ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„ç…§ç‰‡æ•°æ®ï¼');
            return;
          }
          
          // ä¿å­˜åˆ°localStorage
          localStorage.setItem('userPhotos', JSON.stringify(validPhotos));
          
          // æ›´æ–°æ˜¾ç¤º
          const savedPhotos = localStorage.getItem('userPhotos');
          const userPhotos = savedPhotos ? JSON.parse(savedPhotos) : [];
          photos = userPhotos.length > 0 ? [...userPhotos] : [...defaultPhotos];
          renderPhotos();
          
          // å…³é—­å¯¹è¯æ¡†
          closeImportDialog();
          
          // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
          showMessage(`æˆåŠŸå¯¼å…¥ ${validPhotos.length} å¼ ç…§ç‰‡ï¼`, 'success');
          
        } catch (error) {
          console.error('Import error:', error);
          alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æˆ–æ•°æ®æŸå');
        }
      };
      
      reader.readAsText(file);
      
      // æ¸…ç©ºinputï¼Œå…è®¸é‡å¤é€‰æ‹©ç›¸åŒæ–‡ä»¶
      event.target.value = '';
    }

    // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
    function showMessage(message, type = 'info') {
      const messageDiv = document.createElement('div');
      messageDiv.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 shadow-lg ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
      }`;
      messageDiv.textContent = message;
      
      document.body.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 3000);
    }

    // ç¡®ä¿å‡½æ•°å…¨å±€å¯è®¿é—®
    window.openGallery = openGallery;
    window.closeGallery = closeGallery;
    window.nextImage = nextImage;
    window.previousImage = previousImage;
    window.showImportDialog = showImportDialog;
    window.closeImportDialog = closeImportDialog;

    // æ¸²æŸ“ç…§ç‰‡ç½‘æ ¼
    function renderPhotos() {
      const masonryContainer = document.querySelector('.masonry');
      masonryContainer.innerHTML = '';
      
      if (photos.length === 0) {
        // æ˜¾ç¤ºç©ºçŠ¶æ€
        masonryContainer.innerHTML = `
          <div class="col-span-full w-full text-center py-20">
            <div class="text-gray-400 mb-4">
              <svg class="mx-auto h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </div>
            <h3 class="text-lg font-light text-gray-600 mb-2 title-font">æš‚æ— ç…§ç‰‡ä½œå“</h3>
            <p class="text-sm text-gray-500 mb-6">æ‘„å½±ä½œå“é›†æ­£åœ¨ç­¹å¤‡ä¸­...</p>
          </div>
        `;
        updatePhotoStats();
        return;
      }
      
      photos.forEach((photo, index) => {
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo-item fade-in mb-4 relative group';
        photoDiv.style.animationDelay = `${index * 0.1}s`;
        
        photoDiv.innerHTML = `
          <img src="${photo.src}" 
               alt="${photo.alt}" 
               data-location="${photo.location}"
               data-description="${photo.description || ''}"
               data-full-src="${photo.src}"
               class="cursor-pointer w-full h-auto block"
               onclick="openGallery(${index})" />
        `;
        
        masonryContainer.appendChild(photoDiv);
      });
      
      // é‡æ–°åº”ç”¨æ‡’åŠ è½½
      applyLazyLoading();
      
      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      updatePhotoStats();
    }

    // æ›´æ–°ç…§ç‰‡ç»Ÿè®¡ä¿¡æ¯ï¼ˆå·²ç§»é™¤æ˜¾ç¤ºï¼‰
    function updatePhotoStats() {
      // é¦–é¡µä¸å†æ˜¾ç¤ºç…§ç‰‡ç»Ÿè®¡
    }

    // é‡æ–°åº”ç”¨æ‡’åŠ è½½
    function applyLazyLoading() {
      const images = document.querySelectorAll('.photo-item img');
      images.forEach(img => {
        img.style.opacity = '0';
        img.addEventListener('load', () => {
          img.style.transition = 'opacity 0.5s';
          img.style.opacity = '1';
        });
      });
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      initPhotos();
      
      // ç»‘å®šæ–‡ä»¶è¾“å…¥äº‹ä»¶
      const importFileInput = document.getElementById('importFileInput');
      if (importFileInput) {
        importFileInput.addEventListener('change', handleImportFile);
      }
    });
  </script>
</body>
</html>